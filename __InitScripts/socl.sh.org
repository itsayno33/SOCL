#!/usr/bin/bash

if [ $# -lt 1 ]; then
# docker container run サービス名 のみなら本命引数は空集合とする
    TARG=()
else
# 引数が変更される前に複製
    for arg; do
        TARG=( "${TARG[@]}" $arg )
    done
fi

# EntrydScriptsの実行(フォルダ内のシェルスクリプトの打ち、名前順で一番遅いものを実行。引数も使用する)
scripts_dir=/EntryScript
pushd ~ > /dev/null
for scripts in `ls -Ar -- ${scripts_dir}/*.sh`;
do
        # 拡張子が「.sh」でファイル名として正しくフォルダ内に存在しており
        # 実行権があってファイルサイズが0で無ければ実行
        if [ -f $scripts ] && [ -e $scripts ] && [ -x $scripts ] && [ -s $scripts ]; then
            echo "sudo -E -u ${__SOCL_USER} source ${scripts_dir}/${scripts} ${TARG[@]}"
            sudo -E -u ${__SOCL_USER} source "${scripts_dir}/${scripts} ${TARG[@]}"
            if   [ $? -ne 0 ]; then exit $? fi #スクリプトが異常終了していたら処理打ち切り
            break
        fi
done
popd > /dev/null
